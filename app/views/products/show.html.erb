<h1>Product details</h1>
<!-- Paths are absolute to avoid a missing :id error when recovering from an error in review form (from /products/:product_id/reviews). -->
<%= link_to 'Edit', edit_product_path(@product), title: "Change this product's details" %>
<%= link_to 'Delete', product_path(@product), title: "Delete this product", :'data-method' => 'delete' %>
<%= render 'products/product', :product => @product %>

<!-- Only list reviews if they are there! -->
<%  num_reviews = @product.reviews.count
    if num_reviews > 0 
%>
  <h2 id="reviews"><%= num_reviews %> Reviews</h2>
  <% @product.reviews.each do |review| %>
    <% if current_user && review.id %>
      <%= link_to 'Edit', edit_product_review_path(@product, review), title: "Change this review" %>
      <%= link_to 'Delete', product_review_path(@product, review), title: "Delete this review", :'data-method' => 'delete' %>
    <% end %>
    <p><%= review.comment %></p>
    <% if review.user != nil %>
      <p>
        Author: <em><%= review.user.username %></em>
        Added on: <%= review.created_at %>
      </p>
    <% end %>
  <% end %>
  <h3 id="reviews">New review</h3>
<% else %>
  <h2 id="reviews">New review</h2>
  <p>Be the first to review this product!</p>
<% end %>

<!-- Show review form only if logged in -->
<% if current_user %>
  <%= render 'reviews/form' %>
<% else %>
  <p>Please <%= link_to "log in", new_session_path %> to add a review.</p>
<% end %>